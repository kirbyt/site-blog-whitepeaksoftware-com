<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->

<head>

    <meta charset="utf-8" />

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Last week I tweeted about having rotation issues with an iPad app I’m working on. This is the second time in recent weeks I’ve encountered rotation issues in an app. In both instances I was using a UIScrollView so I started thinking the UIScrollView was source of my problems. In the most recent instance the UIScrollView contains a UIView that uses a number of CALayer instances for content display.

" />

    <link rel="canonical" href="http://blog.whitepeaksoftware.com/2010/08/23/dont-rely-on-uidevice-orientation-for-rotation/">

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Don't Rely on UIDevice orientation for Rotation - White Peak Software Blog" />
    <meta property="og:description" content="Last week I tweeted about having rotation issues with an iPad app I’m working on. This is the second time in recent weeks I’ve encountered rotation issues in an app. In both instances I was using a UIScrollView so I started thinking the UIScrollView was source of my problems. In the most recent instance the UIScrollView contains a UIView that uses a number of CALayer instances for content display.

" />
    <meta property="og:url" content="http://blog.whitepeaksoftware.com/2010/08/23/dont-rely-on-uidevice-orientation-for-rotation/" />
    <meta property="og:site_name" content="White Peak Software" />


    <title>Don't Rely on UIDevice orientation for Rotation - White Peak Software Blog</title>

    <link rel="alternate" type="application/atom+xml" title="White Peak Software Blog Feed" href="http://blog.whitepeaksoftware.com/atom.xml" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets-custom/img/favicon.png">

    <!-- Web Fonts -->
    <link rel="shortcut" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin">

    <!-- CSS Global Compulsory -->
    <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
    <link href="/assets/css/style.css" rel="stylesheet" />

    <!-- CSS Header and Footer -->
    <link href="/assets/css/headers/header-default.css" rel="stylesheet" />
    <link href="/assets/css/footers/footer-v1.css" rel="stylesheet" />



    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="/assets/plugins/animate.css">
    <link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css">
    <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="/assets/plugins/layer-slider/layerslider/css/layerslider.css">


    <!-- CSS Page Style -->    
    <link rel="stylesheet" href="/assets/css/pages/blog.css">
    <link rel="stylesheet" href="/assets/css/pages/blog_magazine.css">




    <!-- Fancybox -->
    <link rel="stylesheet" href="/assets/plugins/fancybox/source/jquery.fancybox.css">


    <!-- CSS Theme -->
    <link href="/assets/css/theme-colors/blue.css" rel="stylesheet" />

    <!-- CSS Customization -->
    <link rel="stylesheet" href="/assets-custom/css/custom.css">

</head>


<body style="padding-top: 47px;">
  <div class='header'>
  <nav class='navbar navbar-default navbar-fixed-top' role='navigation'>
    <div class='container'>
      <div class='navbar-header'>
        <button class='navbar-toggle' data-target='.navbar-responsive-collapse' data-toggle='collapse' type='button'>
          <span class='sr-only'>
            Toggle navigation
          </span>
          <span class='fa fa-bars'></span>
        </button>
        <a class='navbar-brand' href='http://www.whitepeaksoftware.com/'>
          <img align='left' hspace='6px' src='/assets-custom/img/company-logo.png' style='max-width:100px; margin-top: -7px;'>WHITE PEAK SOFTWARE</img>
        </a>
      </div>
      <div class='collapse navbar-collapse navbar-responsive-collapse navbar-right'>
        <ul class='nav navbar-nav'>
          <li><a href="http://www.whitepeaksoftware.com/">Products</a></li>
          <li><a href="http://www.whitepeaksoftware.com/support">Support</a></li>
          <li><a href="http://www.whitepeaksoftware.com/contact">Contact Us</a></li>
          <li class='active'><a href="/">Blog</a></li>
        </ul>
      </div>
    </div>
  </nav>
</div>



  <!--=== Content Part ===-->
  <div class="container content">
    <div class="row blog-page">
          <!-- Left Sidebar -->
        <div class="col-md-9">

          <!--Blog Post-->
<div class="blog margin-bottom-40">
  <h2><a href="">Don't Rely on UIDevice orientation for Rotation</a></h2>
  <div class="blog-post-tags">
      <ul class="list-unstyled list-inline blog-info">
          <li><i class="fa fa-calendar"></i> August 23, 2010</li>
          <li><i class="fa fa-pencil"></i> Kirby Turner</li>
      </ul>

      
      <ul class="list-unstyled list-inline blog-tags">
          <li>
              <i class="fa fa-tags"></i>
              
          </li>
      </ul>
      
  </div>
  <p>Last week I tweeted about having rotation issues with an iPad app I’m working on. This is the second time in recent weeks I’ve encountered rotation issues in an app. In both instances I was using a <code class="highlighter-rouge">UIScrollView</code> so I started thinking the <code class="highlighter-rouge">UIScrollView</code> was source of my problems. In the most recent instance the <code class="highlighter-rouge">UIScrollView</code> contains a <code class="highlighter-rouge">UIView</code> that uses a number of <code class="highlighter-rouge">CALayer</code> instances for content display.</p>

<p>For those who don’t know, in Mac OS X 10.5 and greater, <code class="highlighter-rouge">CALayer</code> has the <code class="highlighter-rouge">autoresizingMask</code> property. Unfortunately this property does not exists under iOS, so it’s up to my code to do the resizing CALayers as needed. This is where the rotation issue revealed itself.</p>

<p>As the device is rotated from portrait to landscape, or vice versa, my view must resize and adjust the layout of the CALayers. Because <code class="highlighter-rouge">UIView</code> does not receive the rotation notifications I decided to be smart and use the <a href="http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIDevice_Class/Reference/UIDevice.html#//apple_ref/doc/uid/TP40006902-CH3-SW3">orientation property</a> from <code class="highlighter-rouge">UIDevice</code>. So in my view I had code similar to this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>UIInterfaceOrientation interfaceOrientation = [[UIDevice currentDevice] orientation];

if (UIInterfaceOrientationIsLandscape(interfaceOrientation) == YES) {

    // Adjust for landscape.

} else {

    // Adjust for portrait.

}
</code></pre>
</div>

<p>What I failed to realize, however, is that the property <code class="highlighter-rouge">orientation</code> will <strong>always</strong> return 0 unless orientation notifications are enabled. Here is a quote directly from the Developer Documentation:</p>

<p>“The value of this property always returns 0 unless orientation notifications have been enabled by calling beginGeneratingDeviceOrientationNotifications.”</p>

<p>Doh! Guess I should have RTFM sooner.</p>

<p>Because the <code class="highlighter-rouge">orientation</code> property will return 0, sometimes the view in my app would not rotate. But I didn’t know this was the source of the problem at the time.</p>

<p>After banging my head over and over on the wall, I decided to investigate exactly what was happening. I never suspected <code class="highlighter-rouge">[[UIDevice currentDevice] orientation]</code> but eventually I noticed it was returning 0. This seemed odd so I checked the Developer Documentation. I wasn’t expecting to learn anything new. Boy, was I wrong. I was surprised when I read the property always returns 0 when orientation notifications are not enabled.</p>

<p>I now knew the source of my rotation problems, and a likely quick fix to the problem would have been to call <code class="highlighter-rouge">beginGeneratingDeviceOrientationNotifications</code>, get the device orientation, then call <code class="highlighter-rouge">endGeneratingDeviceOrientationNotifications</code>. But this just seemed wrong to me. The better fix, in my opinion, is to rely on the rotation notifications received by the view controller, so that’s exactly what I did.</p>

<p>Now in my particular situation, there are two times I want to resize and layout the CALayers in the <code class="highlighter-rouge">UIView</code>. One of those times is when the device is rotated, which is when the view controller receives the <code class="highlighter-rouge">willRotateToInterfaceOrientation:duration:</code> message. This was easy to solve. I added an <code class="highlighter-rouge">adjustLayoutToInterfaceOrientation:</code> method to my <code class="highlighter-rouge">UIView</code> and I call the method inside the UIViewController’s <code class="highlighter-rouge">willRotateToInterfaceOrientation:duration:</code> method. For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- (void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration 

{
    [view_ adjustLayoutToInterfaceOrientation:toInterfaceOrientation];
}
</code></pre>
</div>

<p>The other time my <em>UIView</em> needs to adjust the layout of the CALayers is when the <em>UIScrollView</em> scrolls. I’m using a modified version of Matt Gallagher’s <a href="http://cocoawithlove.com/2009/01/multiple-virtual-pages-in-uiscrollview.html">virtual pages in a UIScrollView</a> approach, so the contents of my view changes as the user scrolls. This is where, previously, I was trying to be smart and use the <em>orientation</em> property from <em>UIDevice</em>. But what I really need is the current orientation as received in the most recent call to <code class="highlighter-rouge">willRotateToInterfaceOrientation:duration:</code>.</p>

<p>My solution was to add the ivar currentOrientation to my view controller. My view already has a reference to the view controller. I exposed currentOrientation so my view can retrieve the property value. This allowed me to replace the <code class="highlighter-rouge">[[UIDevice currentDevice] orientation]</code> code with <code class="highlighter-rouge">[controller currentOrientation]</code>. Now the view always knows the current orientation and the app does not need to enable orientation notification in code.</p>

<p>As a result, the first code snippet in this posting changes to:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>UIInterfaceOrientation interfaceOrientation = [controller_ currentOrientation];

if (UIInterfaceOrientationIsLandscape(interfaceOrientation) == YES) {

    // Adjust for landscape.

} else {

    // Adjust for portrait.

}
</code></pre>
</div>

<p>And the <code class="highlighter-rouge">willRotateToInterfaceOrientation:duration:</code> implementation changes to:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- (void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration 

{

    currentOrientation_ = toInterfaceOrientation;

    [view_ adjustLayoutToInterfaceOrientation:toInterfaceOrientation];

}
</code></pre>
</div>

<p>This has been an eye opener for me, and I now have a new rule of thumb. Never use <code class="highlighter-rouge">UIDevice orientation</code> in code that is responsible for the resizing and layouts of subviews and CALayers.</p>


</div>
<!--End Blog Post-->

<hr>

<div class="text-center">
  <ul class="pagination">
    
    <li><a href="/2010/08/21/new-safari-theme-for-hey-peanut/" title="Previous Post: New Safari Theme for Hey Peanut">&larr; Previous Post</a></li>
    

    <li><a href="/">Index</a></li>
    <li><a href="/blog/archives">Archive</a></li>

    
    <li><a href="/2010/08/26/ann-hey-peanut-1-3-is-in-the-app-store/" title="Next Post: ANN: Hey Peanut 1.3 is in the App Store">Next Post &rarr;</a></li>
    
  </ul>
</div>


        </div>
        <!-- End Left Sidebar -->

        <!-- Right Sidebar -->
        <div class="col-md-3 magazine-page">

          <!-- Posts -->
          <div class="posts margin-bottom-40">
              <div class="headline headline-md"><h2>Recent Posts</h2></div>
              
                <ul class="list-unstyled recent-post">
                  <li>
                    <a href="/2015/11/20/special-offer-for-killink-csv-editor-customers/">Special Offer For Killink CSV Editor Customers</a>
                    <small>November 20, 2015</small>
                  </li>
                </ul>
              
                <ul class="list-unstyled recent-post">
                  <li>
                    <a href="/2015/08/18/killinks-retirement/">ANN: Killink's Retirement</a>
                    <small>August 18, 2015</small>
                  </li>
                </ul>
              
                <ul class="list-unstyled recent-post">
                  <li>
                    <a href="/2015/08/13/ann-peak-app-care/">ANN: Peak App Care</a>
                    <small>August 13, 2015</small>
                  </li>
                </ul>
              
                <ul class="list-unstyled recent-post">
                  <li>
                    <a href="/2015/03/25/quickly-post-photos-to-facebook/">Quickly Post Photos To Facebook</a>
                    <small>March 25, 2015</small>
                  </li>
                </ul>
              
                <ul class="list-unstyled recent-post">
                  <li>
                    <a href="/2015/01/01/2014-year-in-review/">2014 Year In Review</a>
                    <small>January 01, 2015</small>
                  </li>
                </ul>
              
          </div><!--/posts-->
          <!-- End Posts -->

          <!-- Blog Tags -->
          <div class="headline headline-md"><h2>Categories</h2></div>
          <ul class="list-unstyled blog-tags margin-bottom-30">
              <li class='category'><a href='/category/announcements/'>announcements (25)</a></li>
<li class='category'><a href='/category/big%20screen/'>big screen (1)</a></li>
<li class='category'><a href='/category/conferences/'>conferences (1)</a></li>
<li class='category'><a href='/category/cross%20post/'>cross post (3)</a></li>
<li class='category'><a href='/category/general/'>general (3)</a></li>
<li class='category'><a href='/category/hey%20peanut/'>hey peanut (5)</a></li>
<li class='category'><a href='/category/ios/'>ios (4)</a></li>
<li class='category'><a href='/category/killink%20csv/'>killink csv (3)</a></li>
<li class='category'><a href='/category/labor%20mate/'>labor mate (4)</a></li>
<li class='category'><a href='/category/peak%20app%20care/'>peak app care (1)</a></li>
<li class='category'><a href='/category/programming/'>programming (1)</a></li>
<li class='category'><a href='/category/smtp%20diagnostics/'>smtp diagnostics (1)</a></li>

          </ul>
          <!-- End Blog Tags -->


        </div>
        <!-- End Right Sidebar -->
      </div><!--/row-->
  </div><!--/container-->
  <!--=== End Content Part ===-->


  <!--=== Footer ===-->
<div class='footer-v1' id='footer-v1'>
  <div class='footer'>
    <div class='container'>
      <div class='row'>
        <div class='col-md-4 md-margin-bottom-40'>
          <div class='headline'>
            <h2 data-drip-attribute='headline'>Newsletter</h2>
          </div>
          <p data-drip-attribute='description'>Subscribe to our newsletter and stay up to date with the latest news and deals!</p>
          <form action='https://www.getdrip.com/forms/1196122/submissions' class='footer-subsribe' data-drip-embedded-form='1196122' id='formNewsletter' method='post'>
            <div class='input-group'>
              <input class='form-control' name='fields[email]' placeholder='Email Address' type='email'>
              <span class='input-group-btn'>
                <button class='btn-u' data-drip-attribute='sign-up-button' form='formNewsletter' type='submit' value='Subscribe'>Subscribe</button>
              </span>
            </div>
          </form>
        </div>
        <div class='col-md-4 md-margin-bottom-40'>
          <!-- .posts -->
          <!-- .headline -->
          <!-- %h2 Company News -->
          <!-- %ul.list-unstyled.link-list -->
          <!-- %li -->
          <!-- = link_to('ANN: Killink\'s Retirement', '/') -->
          <!-- %i.fa.fa-angle-right -->
          <!-- %li -->
          <!-- = link_to('ANN: Peak App Care', '/') -->
          <!-- %i.fa.fa-angle-right -->
          <!-- %li -->
          <!-- = link_to('ANN: Cross Post v1.2 is in the App Store', '/') -->
          <!-- %i.fa.fa-angle-right -->
          <!-- %li -->
          <!-- = link_to('More White Peak News...', '/') -->
          <!-- %i.fa.fa-angle-right -->
        </div>
        <div class='col-md-4 md-margin-bottom-40'>
          <div class='headline'>
            <h2>More Info</h2>
          </div>
          <ul class='list-unstyled link-list'>
            <li><a href="http://www.whitepeaksoftware.com/about">About Us</a></li>
            <li><a href="http://www.whitepeaksoftware.com/contact">Contact Us</a></li>
            <li><a href="http://www.whitepeaksoftware.com/retiredproducts">Retired Products</a></li>
            <li><a href="http://www.whitepeaksoftware.com/privacypolicy">Privacy Policy</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class='copyright'>
    <div class='container'>
      <div class='row'>
        <div class='col-md-9'>
          <p>Copyright &copy; 2003-2015 White Peak Software, Inc. All Rights Reserved.</p>
        </div>
      </div>
    </div>
  </div>
</div>
<!--=== End Footer ===-->



  <!-- JS Global Compulsory -->
<script src="/assets/plugins/jquery/jquery.min.js"></script>
<script src="/assets/plugins/jquery/jquery-migrate.min.js"></script>
<script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- JS Implementing Plugins -->
<script src="/assets/plugins/back-to-top.js"></script>
<script src="/assets/plugins/smoothScroll.js"></script>
<script type="text/javascript" src="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script>
<script type="text/javascript" src="/assets/plugins/layer-slider/layerslider/js/greensock.js"></script>
<script type="text/javascript" src="/assets/plugins/layer-slider/layerslider/js/layerslider.transitions.js"></script>
<script type="text/javascript" src="/assets/plugins/layer-slider/layerslider/js/layerslider.kreaturamedia.jquery.js"></script>

<!-- JS Customization -->
<script type="text/javascript" src="/assets/js/custom.js"></script>

<!-- JS Page Level -->
<script type="text/javascript" src="/assets/js/app.js"></script>

<script type="text/javascript" src="/assets/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="/assets/js/plugins/fancy-box.js"></script>


<script type="text/javascript" src="/assets/js/plugins/owl-carousel.js"></script>
<script type="text/javascript" src="/assets/js/plugins/layer-slider.js"></script>

<script type="text/javascript">
    jQuery(document).ready(function() {
        App.init();
        FancyBox.initFancybox();
        OwlCarousel.initOwlCarousel();
        LayerSlider.initLayerSlider();
    });
</script>

<!--[if lt IE 9]>
    <script src="/assets/plugins/respond.js"></script>
    <script src="/assets/plugins/html5shiv.js"></script>
    <script src="/assets/plugins/placeholder-IE-fixes.js"></script>
<![endif]-->

<script type="text/javascript" src="/assets-custom/js/retina.min.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-167605-2', 'auto');
  ga('send', 'pageview');

</script>

<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '4071369';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/4071369.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>


</body>
</html>
